    -- ==================== AUTO BANK MODULE ====================
    -- Ch·ª©c nƒÉng: T·ª± ƒë·ªông b·ªè v≈© kh√≠ v√† pet c√≥ gi√° tr·ªã v√†o Bank
    -- Requirements: WindUI, global variables from main scriptxxxxxxxxxxxx
    -- ===========================================================

    local Module = {}

    -- T·∫Øt to√†n b·ªô log console trong module n√†y
    local warn = function(...) end

    -- ‚úÖ Declare variables (will be initialized in Init())
    local WindUI, Window, ConfigSystem, Toggles, Options
    local Players = game:GetService("Players")
    local c, d, e, bQ, bR
    local ReplicatedStorage, Shared, Bank, TransferToBank, WithdrawFromBank
    local PlayerGui, Profile, InventoryItems

    -- ==================== GLOBALS ====================
    local BankGlobals = {
        -- Auto Bank ALL toggles (kh√¥ng check perk)
        isAutoBankingAllWeapons = false,
        isAutoBankingAllPets = false,
        
        -- Config cho min tier
        weaponMinTier = 5,
        petMinTier = 5,
        
        -- Statistics
        totalWeaponsBanked = 0,
        totalPetsBanked = 0,
        sessionStartTime = 0,
        
        -- Config file (will be set in Init)
        ConfigFile = nil
    }

    -- ==================== UTILITY FUNCTIONS ====================
    local function libNoti(msg, duration)
        WindUI:Notify({
            Title = "Auto Bank",
            Content = msg,
            Duration = duration or 5
        })
    end

    local function formatNumber(num)
        if num >= 1000000 then
            return string.format("%.1fM", num / 1000000)
        elseif num >= 1000 then
            return string.format("%.1fK", num / 1000)
        else
            return tostring(num)
        end
    end

    local function timeElapsed(seconds)
        local hours = math.floor(seconds / 3600)
        local mins = math.floor((seconds % 3600) / 60)
        local secs = seconds % 60
        
        if hours > 0 then
            return string.format("%dh %dm %ds", hours, mins, secs)
        elseif mins > 0 then
            return string.format("%dm %ds", mins, secs)
        else
            return string.format("%ds", secs)
        end
    end

    -- ==================== BANK FUNCTIONS ====================
    -- L·∫•y th√¥ng tin bank capacity (ƒë·∫øm tr·ª±c ti·∫øp t·ª´ Profile.Bank.Items)
    local function getBankInfo()
        local maxCapacity = 120 -- Default fallback
        
        -- L·∫•y max capacity t·ª´ Profile.Bank.Slots
        if Profile then
            local bankFolder = Profile:FindFirstChild("Bank")
            if bankFolder then
                local slotsValue = bankFolder:FindFirstChild("Slots")
                if slotsValue and slotsValue.Value then
                    maxCapacity = tonumber(slotsValue.Value) or 120
                end
            end
        end
        
        -- ƒê·∫øm s·ªë items trong bank t·ª´ Profile.Bank.Items
        local currentCount = 0
        if Profile then
            local bankFolder = Profile:FindFirstChild("Bank")
            if bankFolder then
                local itemsFolder = bankFolder:FindFirstChild("Items")
                if itemsFolder then
                    currentCount = #itemsFolder:GetChildren()
                end
            end
        end
        
        return currentCount, maxCapacity
    end

    -- Ki·ªÉm tra xem bank c√≥ ƒë·∫ßy kh√¥ng
    local function isBankFull()
        local current, max = getBankInfo()
        return current >= max
    end

    -- B·ªè item v√†o bank
    local function transferToBank(item, quantity)
        if not item or not item.Parent then
            return false
        end
        
        if isBankFull() then
            libNoti("‚ö†Ô∏è Bank ƒë√£ ƒë·∫ßy! Kh√¥ng th·ªÉ th√™m item.", 3)
            return false
        end
        
        local success = pcall(function()
            TransferToBank:FireServer(item, quantity or 1)
        end)
        
        if success then
            task.wait(0.2) -- Wait for replication
        end
        
        return success
    end

    -- L·∫•y item t·ª´ bank
    local function withdrawFromBank(item, quantity)
        if not item or not item.Parent then
            return false
        end
        
        local success = pcall(function()
            WithdrawFromBank:FireServer(item, quantity or 1)
        end)
        
        if success then
            task.wait(0.2) -- Wait for replication
        end
        
        return success
    end

    -- ==================== WEAPON FUNCTIONS ====================
    -- L·∫•y tier c·ªßa weapon
    local function getWeaponTier(weaponItem)
        if not weaponItem or not weaponItem:FindFirstChild("Tier") then
            return nil
        end
        
        return weaponItem.Tier.Value
    end

    -- Ki·ªÉm tra weapon c√≥ ƒë√°p ·ª©ng ƒëi·ªÅu ki·ªán bank kh√¥ng
    local function shouldBankWeapon(weaponItem)
        local itemData = bR[weaponItem.Name]
        if not itemData or (itemData.Type ~= "Weapon" and itemData.Type ~= "Armor") then
            return false, "Not a weapon/armor"
        end
        
        -- Ki·ªÉm tra tier
        local tier = getWeaponTier(weaponItem)
        if not tier or tier < BankGlobals.weaponMinTier then
            return false, string.format("Tier %d < min tier %d", tier or 0, BankGlobals.weaponMinTier)
        end
        
        -- Ki·ªÉm tra perks (s·ª≠ d·ª•ng Options t·ª´ main script)
        local hasValidPerk = false
        local bestPerkInfo = nil
        local shouldKeep = false
        
        for _, child in ipairs(weaponItem:GetChildren()) do
            if child:IsA("StringValue") and child:FindFirstChild("PerkValue") then
                local perkName = child.Value
                local perkValue = child.PerkValue.Value
                
                local perkData = bQ[perkName]
                
                if perkData then
                    local canAppearOnWeapon = not perkData.ArmorOnly and not perkData.PetOnly
                    local statRange = perkData.StatRange
                    
                    if canAppearOnWeapon and statRange then
                        hasValidPerk = true
                        
                        -- ‚úÖ L·∫•y threshold t·ª´ Options (gi·ªëng smartPerkSell)
                        local threshold = 0
                        if _G.Options and _G.Options[perkName] then
                            local optionValue = tonumber(_G.Options[perkName].Value) or 999
                            -- Ch·ªâ √°p d·ª•ng threshold n·∫øu ƒë√£ ƒë∆∞·ª£c config (< 999)
                            if optionValue < 999 then
                                threshold = optionValue
                            end
                        end
                        
                        local perkPercent = math.round(perkValue * 100)
                        local meetsThreshold = perkPercent >= threshold
                        
                        if meetsThreshold and not shouldKeep then
                            shouldKeep = true
                        end
                        
                        if not bestPerkInfo or meetsThreshold or (not shouldKeep and perkPercent > bestPerkInfo.value) then
                            bestPerkInfo = {
                                name = perkData.DisplayName,
                                value = perkPercent,
                                threshold = threshold,
                                meets = meetsThreshold
                            }
                        end
                    end
                end
            end
        end
        
        if not hasValidPerk then
            return false, "No valid perk"
        end
        
        if not shouldKeep then
            return false, string.format("%s: %.1f%% < %.1f%%", bestPerkInfo.name, bestPerkInfo.value, bestPerkInfo.threshold)
        end
        
        return true, string.format("%s: %.1f%% ‚â• %.1f%%", bestPerkInfo.name, bestPerkInfo.value, bestPerkInfo.threshold)
    end

    -- L·∫•y t·∫•t c·∫£ weapons trong inventory
    local function getAllWeaponsInInventory()
        local weapons = {}
        
        for _, item in ipairs(InventoryItems:GetChildren()) do
            if item:IsA("Folder") then
                local itemData = bR[item.Name]
                if itemData and (itemData.Type == "Weapon" or itemData.Type == "Armor") then
                    table.insert(weapons, item)
                end
            end
        end
        
        return weapons
    end

    -- Bank m·ªôt weapon
    local function bankWeapon(weaponItem, skipCheck)
        local shouldBank, reason
        
        if skipCheck then
            -- Kh√¥ng ki·ªÉm tra ƒëi·ªÅu ki·ªán, bank lu√¥n
            shouldBank = true
            reason = "Auto bank all enabled"
        else
            shouldBank, reason = shouldBankWeapon(weaponItem)
        end
        
        if not shouldBank then
            return false, reason
        end
        
        local success = transferToBank(weaponItem, 1)
        
        if success then
            BankGlobals.totalWeaponsBanked = BankGlobals.totalWeaponsBanked + 1
            local itemData = bR[weaponItem.Name]
            if not skipCheck then
                libNoti(string.format("‚úÖ Banked weapon: %s | %s", itemData.DisplayKey or weaponItem.Name, reason), 2)
            end
        end
        
        return success, reason
    end

    -- ==================== PET FUNCTIONS ====================
    -- L·∫•y tier c·ªßa pet
    local function getPetTier(petItem)
        if not petItem or not petItem:FindFirstChild("Variant") then
            return nil
        end
        
        local petName = petItem.Name
        local variantValue = petItem.Variant.Value
        
        local itemData = bR[petName]
        if not itemData or itemData.Type ~= "Pet" or not itemData.Variants then
            return nil
        end
        
        for _, variant in ipairs(itemData.Variants) do
            if variant[1] == variantValue then
                return variant[4]
            end
        end
        
        return nil
    end

    -- Ki·ªÉm tra pet c√≥ ƒë√°p ·ª©ng ƒëi·ªÅu ki·ªán bank kh√¥ng
    local function shouldBankPet(petItem)
        local itemData = bR[petItem.Name]
        if not itemData or itemData.Type ~= "Pet" then
            return false, "Not a pet"
        end
        
        -- Ki·ªÉm tra tier
        local tier = getPetTier(petItem)
        if not tier or tier < BankGlobals.petMinTier then
            return false, string.format("Tier %d < min tier %d", tier or 0, BankGlobals.petMinTier)
        end
        
        -- Ki·ªÉm tra perks (l·∫•y t·ª´ module Auto Hatch n·∫øu c√≥, ho·∫∑c t·ª´ config)
        local hasValidPerk = false
        local bestPerkInfo = nil
        local shouldKeep = false
        
        -- ‚úÖ Fetch pet perk thresholds t·ª´ config ƒë√£ load
        local petPerkThresholds = {}
        if _G.ConfigSystem and _G.ConfigSystem.lastLoadedConfig and _G.ConfigSystem.lastLoadedConfig.HatchGlobals then
            local hatchConfig = _G.ConfigSystem.lastLoadedConfig.HatchGlobals
            if hatchConfig.petPerkThresholds then
                for key, value in pairs(hatchConfig.petPerkThresholds) do
                    -- Remove prefix "PetPerk_" if exists
                    local perkKey = key
                    if string.sub(key, 1, 8) == "PetPerk_" then
                        perkKey = string.sub(key, 9)
                    end
                    petPerkThresholds[perkKey] = tonumber(value) or 999
                end
            end
        end
        
        for _, child in ipairs(petItem:GetChildren()) do
            if child:IsA("StringValue") and child:FindFirstChild("PerkValue") then
                local perkName = child.Value
                local perkValue = child.PerkValue.Value
                
                local perkData = bQ[perkName]
                
                if perkData then
                    local canAppearOnPet = (not perkData.WeaponOnly and not perkData.ArmorOnly) or perkData.PetOnly
                    local statRange = perkData.PetStatRange or perkData.StatRange
                    
                    if canAppearOnPet and statRange then
                        hasValidPerk = true
                        
                        -- ‚úÖ L·∫•y threshold t·ª´ petPerkThresholds (gi·ªëng Auto Hatch)
                        local threshold = 0
                        local configThreshold = petPerkThresholds[perkName] or 999
                        -- Ch·ªâ √°p d·ª•ng threshold n·∫øu ƒë√£ ƒë∆∞·ª£c config (< 999)
                        if configThreshold < 999 then
                            threshold = configThreshold
                        end
                        
                        local perkPercent = math.round(perkValue * 100)
                        local meetsThreshold = perkPercent >= threshold
                        
                        if meetsThreshold and not shouldKeep then
                            shouldKeep = true
                        end
                        
                        if not bestPerkInfo or meetsThreshold or (not shouldKeep and perkPercent > bestPerkInfo.value) then
                            bestPerkInfo = {
                                name = perkData.DisplayName,
                                value = perkPercent,
                                threshold = threshold,
                                meets = meetsThreshold
                            }
                        end
                    end
                end
            end
        end
        
        if not hasValidPerk then
            return false, "No valid perk"
        end
        
        if not shouldKeep then
            return false, string.format("%s: %.1f%% < %.1f%%", bestPerkInfo.name, bestPerkInfo.value, bestPerkInfo.threshold)
        end
        
        return true, string.format("%s: %.1f%% ‚â• %.1f%%", bestPerkInfo.name, bestPerkInfo.value, bestPerkInfo.threshold)
    end

    -- L·∫•y t·∫•t c·∫£ pets trong inventory
    local function getAllPetsInInventory()
        local pets = {}
        
        for _, item in ipairs(InventoryItems:GetChildren()) do
            if item:IsA("Folder") then
                local itemData = bR[item.Name]
                if itemData and itemData.Type == "Pet" then
                    table.insert(pets, item)
                end
            end
        end
        
        return pets
    end

    -- Bank m·ªôt pet
    local function bankPet(petItem, skipCheck)
        local shouldBank, reason
        
        if skipCheck then
            -- Kh√¥ng ki·ªÉm tra ƒëi·ªÅu ki·ªán, bank lu√¥n
            shouldBank = true
            reason = "Auto bank all enabled"
        else
            shouldBank, reason = shouldBankPet(petItem)
        end
        
        if not shouldBank then
            return false, reason
        end
        
        local success = transferToBank(petItem, 1)
        
        if success then
            BankGlobals.totalPetsBanked = BankGlobals.totalPetsBanked + 1
            local itemData = bR[petItem.Name]
            if not skipCheck then
                libNoti(string.format("‚úÖ Banked pet: %s | %s", itemData.DisplayKey or petItem.Name, reason), 2)
            end
        end
        
        return success, reason
    end

    -- ==================== AUTO FUNCTIONS ====================
    local function startAutoBank()
        if BankGlobals.sessionStartTime == 0 then
            BankGlobals.sessionStartTime = tick()
        end
        
        -- ‚úÖ Listener cho Auto Bank ALL v·ªõi priority-based delay
        InventoryItems.ChildAdded:Connect(function(item)
            local itemData = bR[item.Name]
            if not itemData then
                return
            end
            
            -- ‚úÖ ƒê·ª£i Auto Sell/Auto Hatch x·ª≠ l√Ω tr∆∞·ªõc
            local shouldWait = false
            
            if itemData.Type == "Weapon" or itemData.Type == "Armor" then
                -- ƒê·ª£i n·∫øu Smart T5 Auto Sell ƒëang B·∫¨T
                if _G.Toggles and _G.Toggles.smartPerkSell and _G.Toggles.smartPerkSell.Value then
                    shouldWait = true
                end
            elseif itemData.Type == "Pet" then
                -- ƒê·ª£i n·∫øu Smart Pet Keep ƒëang B·∫¨T
                if _G.Toggles and _G.Toggles.SmartPetKeep and _G.Toggles.SmartPetKeep.Value then
                    shouldWait = true
                end
            end
            
            -- Delay d·ª±a tr√™n priority
            if shouldWait then
                task.wait(1.5)  -- ƒê·ª£i Auto Sell/Hatch x·ª≠ l√Ω xong (1.5s)
            else
                task.wait(0.1)  -- Delay ng·∫Øn n·∫øu kh√¥ng c·∫ßn wait
            end
            
            -- ‚úÖ Ki·ªÉm tra item c√≤n t·ªìn t·∫°i kh√¥ng (c√≥ th·ªÉ ƒë√£ b·ªã sell)
            if not item or not item.Parent then
                return  -- Item ƒë√£ b·ªã sell/bank r·ªìi
            end
            
            -- Ki·ªÉm tra Auto Bank ALL Weapons
            if itemData.Type == "Weapon" or itemData.Type == "Armor" then
                if BankGlobals.isAutoBankingAllWeapons then
                    bankWeapon(item, true)
                end
            end
            
            -- Ki·ªÉm tra Auto Bank ALL Pets
            if itemData.Type == "Pet" then
                if BankGlobals.isAutoBankingAllPets then
                    bankPet(item, true)
                end
            end
        end)
    end

    -- ==================== CONFIG FUNCTIONS ====================
    local function saveBankConfig()
        if not writefile then return end
        
        local data = {
            totalWeaponsBanked = BankGlobals.totalWeaponsBanked,
            totalPetsBanked = BankGlobals.totalPetsBanked
        }
        
        pcall(function()
            writefile(BankGlobals.ConfigFile, e:JSONEncode(data))
        end)
    end

    local function loadBankConfig()
        if not (isfile and readfile and isfile(BankGlobals.ConfigFile)) then
            return false
        end
        
        local success = pcall(function()
            local data = e:JSONDecode(readfile(BankGlobals.ConfigFile))
            
            BankGlobals.totalWeaponsBanked = data.totalWeaponsBanked or 0
            BankGlobals.totalPetsBanked = data.totalPetsBanked or 0
        end)
        
        return success
    end

    -- ==================== UI CREATION ====================
    local function createInventoryTab()
        local TabInventory = Window:Tab({
            Title = "Inventory",
            Icon = "package",
            Locked = false
        })
        
        TabInventory:Section({ Title = "üè¶ Auto Bank System" })
        
        -- Paragraph hi·ªÉn th·ªã bank info
        local BankInfoParagraph = TabInventory:Paragraph({
            Title = "üìä Bank Status",
            Description = "Loading..."
        })
        
        task.spawn(function()
            while true do
                local current, max = getBankInfo()
                BankInfoParagraph:SetDesc(string.format("üì¶ Bank: %d/%d items", current, max))
                task.wait(1)
            end
        end)
        
        TabInventory:Paragraph({
            Title = "‚ÑπÔ∏è How Auto Bank Works",
            Description = [[
‚Ä¢ Use Smart T5 Auto Sell (Auto Sell tab) to keep good weapons
‚Ä¢ Use Smart Pet Keep (Auto Hatch tab) to keep good pets
‚Ä¢ Auto Bank ALL will bank everything remaining in inventory
‚Ä¢ Useful for clearing inventory quickly
            ]]
        })
        
        TabInventory:Divider({ Text = "Auto Bank ALL" })
        
        -- Weapon Min Tier Slider
        local WeaponMinTierSlider = TabInventory:Slider({
            Title = "Weapon Min Tier",
            Description = "Tier t·ªëi thi·ªÉu ƒë·ªÉ bank (cho Auto Bank ALL)",
            Step = 1,
            Value = {
                Min = 1,
                Max = 5,
                Default = BankGlobals.weaponMinTier
            },
            Callback = function(value)
                BankGlobals.weaponMinTier = value
            end
        })
        ConfigSystem.registerUIElement("BankWeaponMinTier", WeaponMinTierSlider)
        
        -- Auto Bank All Weapons Toggle
        local AutoBankAllWeaponsToggle = TabInventory:Toggle({
            Title = "‚öîÔ∏è Auto Bank ALL Weapons",
            Description = "Bank T·∫§T C·∫¢ weapons (b·ªè qua perk checking)",
            Default = BankGlobals.isAutoBankingAllWeapons,
            Callback = function(state)
                BankGlobals.isAutoBankingAllWeapons = state
                
                if state then
                    libNoti("‚ö†Ô∏è Auto Bank ALL Weapons ƒë√£ B·∫¨T - ƒêang bank to√†n b·ªô inventory...", 3)
                    
                    -- ‚úÖ Qu√©t lu√¥n inventory hi·ªán t·∫°i (bank all)
                    task.spawn(function()
                        task.wait(0.3)
                        local weapons = getAllWeaponsInInventory()
                        local bankedCount = 0
                        
                        for _, weapon in ipairs(weapons) do
                            local success, reason = bankWeapon(weapon, true)
                            if success then
                                bankedCount = bankedCount + 1
                            end
                            task.wait(0.2)
                        end
                        
                        if bankedCount > 0 then
                            libNoti(string.format("‚úÖ ƒê√£ bank to√†n b·ªô %d weapons!", bankedCount), 3)
                        end
                    end)
                else
                    libNoti("‚ùå Auto Bank ALL Weapons ƒë√£ T·∫ÆT", 2)
                end
            end
        })
        ConfigSystem.registerUIElement("AutoBankAllWeapons", AutoBankAllWeaponsToggle)
        _G.Toggles.AutoBankAllWeapons = AutoBankAllWeaponsToggle
        
        TabInventory:Divider({ Text = "Auto Bank Pets" })
        
        -- Pet Min Tier Slider
        local PetMinTierSlider = TabInventory:Slider({
            Title = "Pet Min Tier",
            Description = "Tier t·ªëi thi·ªÉu ƒë·ªÉ bank (cho Auto Bank ALL)",
            Step = 1,
            Value = {
                Min = 1,
                Max = 5,
                Default = BankGlobals.petMinTier
            },
            Callback = function(value)
                BankGlobals.petMinTier = value
            end
        })
        ConfigSystem.registerUIElement("BankPetMinTier", PetMinTierSlider)
        
        -- Auto Bank All Pets Toggle
        local AutoBankAllPetsToggle = TabInventory:Toggle({
            Title = "üêæ Auto Bank ALL Pets",
            Description = "Bank T·∫§T C·∫¢ pets (b·ªè qua perk checking)",
            Default = BankGlobals.isAutoBankingAllPets,
            Callback = function(state)
                BankGlobals.isAutoBankingAllPets = state
                
                if state then
                    libNoti("‚ö†Ô∏è Auto Bank ALL Pets ƒë√£ B·∫¨T - ƒêang bank to√†n b·ªô inventory...", 3)
                    
                    -- ‚úÖ Qu√©t lu√¥n inventory hi·ªán t·∫°i (bank all)
                    task.spawn(function()
                        task.wait(0.3)
                        local pets = getAllPetsInInventory()
                        local bankedCount = 0
                        
                        for _, pet in ipairs(pets) do
                            local success, reason = bankPet(pet, true)
                            if success then
                                bankedCount = bankedCount + 1
                            end
                            task.wait(0.2)
                        end
                        
                        if bankedCount > 0 then
                            libNoti(string.format("‚úÖ ƒê√£ bank to√†n b·ªô %d pets!", bankedCount), 3)
                        end
                    end)
                else
                    libNoti("‚ùå Auto Bank ALL Pets ƒë√£ T·∫ÆT", 2)
                end
            end
        })
        ConfigSystem.registerUIElement("AutoBankAllPets", AutoBankAllPetsToggle)
        _G.Toggles.AutoBankAllPets = AutoBankAllPetsToggle
        
        TabInventory:Divider({ Text = "Withdraw from Bank" })
        
        -- Button Withdraw All Weapons
        TabInventory:Button({
            Title = "‚¨áÔ∏è Withdraw All Weapons",
            Description = "R√∫t t·∫•t c·∫£ weapons t·ª´ bank (double-click)",
            Callback = function()
                local BankItemsFolder = Profile:WaitForChild("Bank"):WaitForChild("Items")
                local withdrawnCount = 0
                
                for _, item in ipairs(BankItemsFolder:GetChildren()) do
                    if item:IsA("Folder") then
                        local itemData = bR[item.Name]
                        if itemData and (itemData.Type == "Weapon" or itemData.Type == "Armor") then
                            local success = withdrawFromBank(item, 1)
                            if success then
                                withdrawnCount = withdrawnCount + 1
                                task.wait(0.2)
                            end
                        end
                    end
                end
                
                if withdrawnCount > 0 then
                    libNoti(string.format("‚úÖ ƒê√£ r√∫t %d weapons t·ª´ bank!", withdrawnCount), 3)
                else
                    libNoti("‚ö†Ô∏è Kh√¥ng c√≥ weapon n√†o trong bank", 3)
                end
            end
        })
        
        -- Button Withdraw All Pets
        TabInventory:Button({
            Title = "‚¨áÔ∏è Withdraw All Pets",
            Description = "R√∫t t·∫•t c·∫£ pets t·ª´ bank (double-click)",
            Callback = function()
                local BankItemsFolder = Profile:WaitForChild("Bank"):WaitForChild("Items")
                local withdrawnCount = 0
                
                for _, item in ipairs(BankItemsFolder:GetChildren()) do
                    if item:IsA("Folder") then
                        local itemData = bR[item.Name]
                        if itemData and itemData.Type == "Pet" then
                            local success = withdrawFromBank(item, 1)
                            if success then
                                withdrawnCount = withdrawnCount + 1
                                task.wait(0.2)
                            end
                        end
                    end
                end
                
                if withdrawnCount > 0 then
                    libNoti(string.format("‚úÖ ƒê√£ r√∫t %d pets t·ª´ bank!", withdrawnCount), 3)
                else
                    libNoti("‚ö†Ô∏è Kh√¥ng c√≥ pet n√†o trong bank", 3)
                end
            end
        })
        
        -- Button Reset Statistics
        TabInventory:Button({
            Title = "üîÑ Reset Statistics",
            Description = "Reset session statistics",
            Callback = function()
                BankGlobals.totalWeaponsBanked = 0
                BankGlobals.totalPetsBanked = 0
                BankGlobals.sessionStartTime = tick()
                saveBankConfig()
                libNoti("‚úÖ Statistics ƒë√£ ƒë∆∞·ª£c reset", 2)
            end
        })
        
        TabInventory:Divider({ Text = "Statistics" })
        
        -- Statistics Paragraph
        local StatsParagraph = TabInventory:Paragraph({
            Title = "üìä Session Stats",
            Description = "Loading..."
        })
        
        task.spawn(function()
            while true do
                local elapsed = tick() - BankGlobals.sessionStartTime
                local stats = string.format(
                    "‚è±Ô∏è Time: %s\n" ..
                    "‚öîÔ∏è Weapons Banked: %s\n" ..
                    "üêæ Pets Banked: %s",
                    timeElapsed(math.floor(elapsed)),
                    formatNumber(BankGlobals.totalWeaponsBanked),
                    formatNumber(BankGlobals.totalPetsBanked)
                )
                
                StatsParagraph:SetDesc(stats)
                task.wait(1)
            end
        end)
    end

    -- ==================== INIT MODULE ====================
    function Module:Init()
        -- ‚úÖ Initialize all global references first
        WindUI = _G.WindUI
        Window = _G.Window
        c = _G.PlayerLocal
        d = _G.UserId
        e = _G.HttpService
        ConfigSystem = _G.ConfigSystem
        Toggles = _G.Toggles
        Options = _G.Options
        bQ = _G.GearPerks
        bR = _G.ItemsModule
        
        -- ‚úÖ Initialize ReplicatedStorage references with error handling
        ReplicatedStorage = game:GetService("ReplicatedStorage")
        local sharedSuccess, sharedResult = pcall(function()
            return ReplicatedStorage:WaitForChild("Shared", 5)
        end)
        
        if not sharedSuccess or not sharedResult then
            warn("‚ö†Ô∏è Auto Bank: Kh√¥ng t√¨m th·∫•y ReplicatedStorage.Shared")
            return
        end
        
        Shared = sharedResult
        
        local bankSuccess, bankResult = pcall(function()
            return Shared:WaitForChild("Bank", 5)
        end)
        
        if not bankSuccess or not bankResult then
            warn("‚ö†Ô∏è Auto Bank: Kh√¥ng t√¨m th·∫•y Shared.Bank")
            return
        end
        
        Bank = bankResult
        TransferToBank = Bank:FindFirstChild("TransferToBank")
        WithdrawFromBank = Bank:FindFirstChild("WithdrawFromBank")
        
        if not TransferToBank or not WithdrawFromBank then
            warn("‚ö†Ô∏è Auto Bank: Kh√¥ng t√¨m th·∫•y Bank RemoteEvents")
            return
        end
        
        -- ‚úÖ Initialize Player GUI references
        PlayerGui = c:WaitForChild("PlayerGui")
        Profile = PlayerGui:WaitForChild("Profile")
        InventoryItems = Profile:WaitForChild("Inventory"):WaitForChild("Items")
        
        -- ‚úÖ Set config file name
        BankGlobals.ConfigFile = "AnyaHub_BankConfig_" .. c.Name .. ".txt"
        
        -- Load config
        loadBankConfig()
        
        -- Create UI
        createInventoryTab()
        
        -- Start auto bank listeners
        startAutoBank()
        
        -- ‚úÖ Hook v√†o ConfigSystem ƒë·ªÉ save/load BankGlobals
        local originalGetConfigData = ConfigSystem.getConfigData
        ConfigSystem.getConfigData = function()
            local data = originalGetConfigData()
            
            -- L∆∞u min tiers v√† Auto Bank ALL toggle states
            data.BankGlobals = {
                weaponMinTier = BankGlobals.weaponMinTier,
                petMinTier = BankGlobals.petMinTier,
                isAutoBankingAllWeapons = BankGlobals.isAutoBankingAllWeapons,
                isAutoBankingAllPets = BankGlobals.isAutoBankingAllPets
            }
            
            return data
        end
        
        local originalLoadConfigData = ConfigSystem.loadConfigData
        ConfigSystem.loadConfigData = function(data)
            originalLoadConfigData(data)
            
            -- ‚úÖ L∆∞u config ƒë·ªÉ shouldBankPet c√≥ th·ªÉ truy c·∫≠p
            if not _G.ConfigSystem then
                _G.ConfigSystem = {}
            end
            _G.ConfigSystem.lastLoadedConfig = data
            
            if data and data.BankGlobals then
                -- Load min tiers (parse to number n·∫øu l√† string)
                if data.BankGlobals.weaponMinTier then
                    BankGlobals.weaponMinTier = tonumber(data.BankGlobals.weaponMinTier) or 5
                end
                
                if data.BankGlobals.petMinTier then
                    BankGlobals.petMinTier = tonumber(data.BankGlobals.petMinTier) or 5
                end
                
                -- ‚úÖ Load Auto Bank ALL toggle states
                if data.BankGlobals.isAutoBankingAllWeapons ~= nil then
                    BankGlobals.isAutoBankingAllWeapons = data.BankGlobals.isAutoBankingAllWeapons
                end
                
                if data.BankGlobals.isAutoBankingAllPets ~= nil then
                    BankGlobals.isAutoBankingAllPets = data.BankGlobals.isAutoBankingAllPets
                end
                
                -- ‚úÖ Update UI elements (sliders v√† toggles)
                task.spawn(function()
                    task.wait(0.5)
                    
                    -- Update weapon min tier slider
                    local weaponMinTierSlider = ConfigSystem.UIElements["BankWeaponMinTier"]
                    if weaponMinTierSlider and weaponMinTierSlider.Set then
                        pcall(function()
                            weaponMinTierSlider:Set(BankGlobals.weaponMinTier)
                        end)
                    end
                    
                    -- Update pet min tier slider
                    local petMinTierSlider = ConfigSystem.UIElements["BankPetMinTier"]
                    if petMinTierSlider and petMinTierSlider.Set then
                        pcall(function()
                            petMinTierSlider:Set(BankGlobals.petMinTier)
                        end)
                    end
                    
                    -- ‚úÖ TH√äM: Update toggles
                    if _G.Toggles.AutoBankAllWeapons then
                        pcall(function()
                            _G.Toggles.AutoBankAllWeapons:SetValue(BankGlobals.isAutoBankingAllWeapons)
                        end)
                    end
                    
                    if _G.Toggles.AutoBankAllPets then
                        pcall(function()
                            _G.Toggles.AutoBankAllPets:SetValue(BankGlobals.isAutoBankingAllPets)
                        end)
                    end
                end)
            end
        end
    end

    return Module
